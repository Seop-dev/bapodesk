import{_ as O,a as S}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as w}from"./main-CfRLyuEJ.js";import{O as s,a8 as I,P,q as U,o as k,a as t,w as o,f,e as m,V as v,b as d,a0 as u,A as C,a1 as B,F,$ as x}from"./index-BkOgXO0r.js";import{_ as $}from"./NewModal-C5NqQFOW.js";import{u as G}from"./auth-DHaV788y.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={__name:"MaterialOrderInsert",setup(z){var g;const p=G(),y=B,n=s([]),A=s([{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"자재유형",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"수량",editable:!0,flex:1}]),a=I({supplier:"",orderDate:new Date().toISOString().substring(0,10),dueDate:"",manager:((g=p.user)==null?void 0:g.name)||""}),i=s(null),D=s(""),c=s([]),_=s([]),V=[{field:"자재코드",headerName:"자재코드",flex:1},{field:"자재명",headerName:"자재명",flex:1},{field:"자재유형",headerName:"자재유형",flex:1},{field:"규격",headerName:"규격",flex:1},{field:"단위",headerName:"단위",flex:1}],T=s([]),h=async r=>{D.value=r,_.value=V;try{const e=await x.get("http://localhost:3000/materials");c.value=e.data.map(l=>({자재코드:l.MAT_CODE,자재명:l.MAT_NAME,자재유형:l.MAT_TYPE,규격:l.MAT_SIZE,단위:l.MAT_UNIT})),i.value&&i.value.open()}catch(e){console.error("자재 목록을 가져오는 중 오류가 발생했습니다:"+e),alert("자재 목록을 불러오는 데 실패했습니다.")}};function E(r){Array.isArray(r)||(r=[r]),r.forEach(e=>{n.value.push({자재명:e.자재명||"",자재코드:e.자재코드||"",자재유형:e.자재유형||"",규격:e.규격||"",단위:e.단위||""})})}function b(){var r;a.supplier="",a.orderDate=new Date().toISOString().substring(0,10),a.dueDate="",a.manager=((r=p.user)==null?void 0:r.name)||"",n.value=[]}async function M(){try{if(!a.supplier||!a.manager||!a.orderDate||!a.dueDate){alert("모든 필드를 입력해주세요.");return}if(n.value.length===0){alert("자재를 선택해주세요.");return}const r={SUPPLYER:a.supplier,ORDER_DATE:a.orderDate,PO_DDAY:a.dueDate,MANAGER:a.manager,PO_STATUS:"대기"},e=n.value.map(l=>({MAT_CODE:l.자재코드,RECEIPT_QTY:l.수량||0}));await x.post("http://localhost:3000/material/order/insert",{orderData:r,detailList:e}),alert("등록 되었습니다."),b()}catch(r){console.error(r),alert("등록 중 오류가 발생했습니다.")}}const R=s({title:"자재발주서"}),N=P([{title:"자재",disabled:!0,href:"#"},{title:"자재발주서 등록",disabled:!1,href:"#"}]);return(r,e)=>(k(),U(F,null,[t(O,{title:R.value.title,breadcrumbs:N.value},null,8,["title","breadcrumbs"]),t(S,{title:"자재발주서 등록"},{default:o(()=>[t(f,{color:"warning",class:"mr-2",onClick:e[0]||(e[0]=l=>h("자재 조회",T.value,V)),style:{"margin-bottom":"2rem"}},{default:o(()=>e[5]||(e[5]=[m(" 자재 조회 ")])),_:1}),t($,{ref_key:"modalRef",ref:i,title:D.value,rowData:c.value,colDefs:_.value,onConfirm:E},null,8,["title","rowData","colDefs"]),t(v,{class:"mb-4"},{default:o(()=>[t(d,{cols:"6"},{default:o(()=>[t(u,{label:"공급처",modelValue:a.supplier,"onUpdate:modelValue":e[1]||(e[1]=l=>a.supplier=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"6"},{default:o(()=>[t(u,{label:"담당자",modelValue:a.manager,"onUpdate:modelValue":e[2]||(e[2]=l=>a.manager=l),outlined:"",readonly:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"6"},{default:o(()=>[t(u,{label:"발주일자",modelValue:a.orderDate,"onUpdate:modelValue":e[3]||(e[3]=l=>a.orderDate=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"6"},{default:o(()=>[t(u,{label:"납기일자",modelValue:a.dueDate,"onUpdate:modelValue":e[4]||(e[4]=l=>a.dueDate=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(C(w),{rowData:n.value,columnDefs:A.value,theme:C(y),style:{height:"200px",width:"100%"},onCellValueChanged:r.onCellValueChanged,onGridReady:r.onGridReady},null,8,["rowData","columnDefs","theme","onCellValueChanged","onGridReady"]),t(v,{justify:"end",class:"button"},{default:o(()=>[t(f,{color:"error",class:"mr-2",onClick:b},{default:o(()=>e[6]||(e[6]=[m("초기화")])),_:1}),t(f,{color:"primary",onClick:M},{default:o(()=>e[7]||(e[7]=[m("등록")])),_:1})]),_:1})]),_:1})],64))}},K=Y(q,[["__scopeId","data-v-b7500333"]]);export{K as default};
