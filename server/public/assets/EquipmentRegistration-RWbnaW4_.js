import{$ as x,a8 as P,O as _,y as Y,_ as q,P as L,q as O,o as $,a,w as s,V as k,b as i,a0 as m,a2 as B,aY as j,e as D,a3 as G,a4 as I,f as H,F as K,H as h}from"./index-BkOgXO0r.js";import{_ as z,a as J}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{u as Q}from"./auth-DHaV788y.js";const le={__name:"EquipmentRegistration",setup(W){var F;const w=Q(),E=h(),C=x.create({baseURL:"http://localhost:3000",headers:{"Content-Type":"application/json"}}),V={nextId:"/facility/next-id",codesFC:"/common/codes/FC",insert:"/facilityInsert",list:"/facility"},y=async(o,e,t=null)=>{var r;try{return await C.request({method:o,url:"/api"+e,data:t})}catch(u){if(((r=u==null?void 0:u.response)==null?void 0:r.status)===404)return await C.request({method:o,url:e,data:t});throw u}},l=P({code:"",name:"",type:"",useYn:"사용",maker:"",makeDate:"",installDate:"",checkCycle:"",manager:((F=w.user)==null?void 0:F.name)||""}),g=_([]),p=_(!1),A=Y(()=>!!l.name&&!!l.type),c=o=>o===""||o===void 0?null:o,T=o=>{if(o===""||o===null||o===void 0)return null;const e=Number(o);return Number.isFinite(e)?e:null},U=o=>String(o).padStart(3,"0"),S=o=>{const e=String(o??"").match(/\d+/),t=Number(e==null?void 0:e[0]);return Number.isFinite(t)?`PRC-${U(t)}`:null};q(async()=>{var o,e,t;try{const[r,u]=await Promise.all([y("get",V.nextId),y("get",V.codesFC)]);l.code=((o=r==null?void 0:r.data)==null?void 0:o.FAC_ID)||"";const f=Array.isArray(u==null?void 0:u.data)?u.data:[];g.value=f.sort((n,d)=>{const b=Number.isFinite(Number(n==null?void 0:n.sort_order))?Number(n.sort_order):9999,N=Number.isFinite(Number(d==null?void 0:d.sort_order))?Number(d.sort_order):9999;return b!==N?b-N:String((n==null?void 0:n.code_name)||"").localeCompare(String((d==null?void 0:d.code_name)||""))})}catch(r){console.error(r),alert("초기 로딩 실패: "+(((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.error)||(r==null?void 0:r.message)))}});const R=async()=>{var t,r,u,f;if(!A.value)return alert("(설비명/설비유형)을 확인하세요.");const o=S(l.type);if(!o){alert("공정(PR_ID) 매핑 실패: 설비유형을 다시 선택하세요.");return}const e={FAC_NAME:c(l.name),FAC_TYPE:c(l.type),FAC_USE:l.useYn==="사용"?1:0,FAC_COMPANY:c(l.maker),FAC_MDATE:c(l.makeDate),FAC_IDATE:c(l.installDate),FAC_CHECKDAY:T(l.checkCycle),PR_ID:o,MANAGER:c(l.manager)};try{p.value=!0;const n=await y("post",V.insert,e),d=(t=n==null?void 0:n.data)==null?void 0:t.FAC_ID;if(!d)throw new Error(((r=n==null?void 0:n.data)==null?void 0:r.error)||"등록 실패");l.code=d,alert("설비 등록 완료!"),E.push({path:"/utils/List",query:{proc:o}})}catch(n){console.error(n),alert(((f=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:f.error)||(n==null?void 0:n.message)||"등록 실패")}finally{p.value=!1}},M=_({title:"설비 정보 관리"}),v=L([{title:"설비",disabled:!0,href:"#"},{title:"설비 등록",disabled:!1,href:"#"}]);return(o,e)=>($(),O(K,null,[a(z,{title:M.value.title,breadcrumbs:v.value},null,8,["title","breadcrumbs"]),a(J,{title:"설비 등록"},{default:s(()=>[a(k,{class:"mb-4"},{default:s(()=>[a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비코드",modelValue:l.code,"onUpdate:modelValue":e[0]||(e[0]=t=>l.code=t),modelModifiers:{trim:!0},dense:"",outlined:"",readonly:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비명",modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.name=t),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(B,{label:"설비유형",modelValue:l.type,"onUpdate:modelValue":e[2]||(e[2]=t=>l.type=t),items:g.value,"item-title":"code_name","item-value":"code",dense:"",outlined:"",clearable:"",placeholder:"유형 선택"},null,8,["modelValue","items"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"제조사",modelValue:l.maker,"onUpdate:modelValue":e[3]||(e[3]=t=>l.maker=t),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"12"},{default:s(()=>[a(j,{class:"mb-2 d-block"},{default:s(()=>e[9]||(e[9]=[D("사용유무")])),_:1}),a(G,{modelValue:l.useYn,"onUpdate:modelValue":e[4]||(e[4]=t=>l.useYn=t),inline:""},{default:s(()=>[a(I,{label:"사용",value:"사용"}),a(I,{label:"정지",value:"정지"})]),_:1},8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비 제조일",modelValue:l.makeDate,"onUpdate:modelValue":e[5]||(e[5]=t=>l.makeDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"설비 설치일",modelValue:l.installDate,"onUpdate:modelValue":e[6]||(e[6]=t=>l.installDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"점검 주기(일)",modelValue:l.checkCycle,"onUpdate:modelValue":e[7]||(e[7]=t=>l.checkCycle=t),modelModifiers:{number:!0},type:"number",min:"0",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),a(i,{cols:"6"},{default:s(()=>[a(m,{label:"담당자",modelValue:l.manager,"onUpdate:modelValue":e[8]||(e[8]=t=>l.manager=t),modelModifiers:{trim:!0},dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{justify:"end"},{default:s(()=>[a(H,{color:"primary",onClick:R,loading:p.value,disabled:p.value||!A.value},{default:s(()=>e[10]||(e[10]=[D("등록")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64))}};export{le as default};
