import{_ as z,a as K}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{O as s,P as Q,_ as W,$ as n,q as H,o as J,a as t,w as d,d as r,a0 as u,f as c,e as m,A as v,a1 as X,V as _,b as D,F as Z}from"./index-BkOgXO0r.js";import{B as k}from"./main-CfRLyuEJ.js";import{_ as ee}from"./NewModal-C5NqQFOW.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"d-flex align-center mb-4"},te={class:"main-container"},oe={class:"list-container"},se={class:"form-wrapper"},de={class:"add"},re={class:"btn-list"},ne={__name:"MasterDiagram",setup(ie){const b=X,o=s({product:"",diagram:"",writer:"",addDate:""}),f=s(null),g=s(null),M=a=>{f.value=a.api},N=a=>{g.value=a.api},C=s([]),O=s([{headerCheckboxSelection:!0,checkboxSelection:!0,width:50},{field:"제품명",editable:!0,width:120},{field:"제품코드",width:130},{field:"제품유형",width:130},{field:"공정흐름도",width:130},{field:"작성자",width:110,editable:!0},{field:"등록일",width:110,editable:!0}]),i=s([]),T=s([{headerCheckboxSelection:!0,checkboxSelection:!0,width:50},{field:"공정순서",type:Number,flex:1,rowDrag:!0,editable:!0},{field:"공정코드",editable:!0,flex:1},{field:"공정명",flex:1},{field:"설비유형",flex:1}]),S=s({title:"공정흐름도 관리"}),F=Q([{title:"기준정보",disabled:!0,href:"#"},{title:"공정흐름도 관리",disabled:!1,href:"#"}]);W(()=>{E(),Y()});const E=async()=>{const a=await n.get("http://localhost:3000/diaPrdList");C.value=a.data.map(e=>({제품명:e.PRD_NAME,제품코드:e.PRD_CODE,제품유형:e.PRD_TYPE,공정흐름도:e.DIA_CODE,작성자:e.PRD_WRITER,등록일:e.PRD_DATE.substring(0,10)}))},V=a=>{console.log(a.value),console.log(C.value)},I=async()=>{const a=g.value.getSelectedRows();if(a.length===0){alert("제품을 선택하세요");return}const e=a.find(h=>h.공정흐름도);if(e){alert(`이미 공정흐름도 코드가 부여된 제품입니다: ${e.제품명}`);return}const p={제품코드:a.map(h=>h.제품코드),작성자:o.value.writer,등록일:o.value.addDate};console.log(p),await n.post("http://localhost:3000/diaInsert",p),await E()},B=()=>{o.value={writer:"",addDate:"",product:"",diagram:""},i.value=[]},w=async()=>{if(!o.value.diagram)return;const a={DIA_CODE:o.value.diagram},e=await n.post("http://localhost:3000/prcList",a);i.value=e.data.map(l=>({공정순서:l.PRC_ORDER,공정코드:l.PRC_CODE,공정명:l.PRC_NAME,설비유형:l.FAC_TYPE}))},L=a=>{o.value.product=a.data.제품명,o.value.diagram=a.data.공정흐름도,o.value.writer=a.data.작성자,o.value.addDate=a.data.등록일,w();const e=f.value.getSelectedRows(),l=g.value.getSelectedRows();console.log(e),console.log(l)},$=async()=>{const a=f.value.getSelectedRows();if(a.length===0){alert("삭제할 공정을 선택하세요.");return}confirm("공정을 삭제하시겠습니까?");const e=a.map(l=>l.공정코드);await n.post("http://localhost:3000/prcDelete",{diaCode:o.value.diagram,prcCode:e}),await w()},U=async()=>{const a=[];f.value.forEachNode((e,l)=>{a.push({DIA_CODE:o.value.diagram,PRC_CODE:e.data.공정코드,PRC_ORDER:l+1})}),console.log(a);try{await n.post("http://localhost:3000/updateProcessOrder",a)}catch(e){console.error("순서 저장 실패",e)}await w()},R=s(null),y=s(""),P=s([]),x=s([]),G=[{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1}],A=s([]),Y=async()=>{const a=await n.get("http://localhost:3000/diaModalList");console.log(a.data),A.value=a.data.map(e=>({공정코드:e.PRC_CODE,공정명:e.PRC_NAME,설비유형:e.FAC_TYPE,등록일자:e.PRC_RDATE.substring(0,10)}))},j=(a,e,l)=>{if(!o.value.product){alert("제품이 선택되지 않았습니다");return}y.value=a,P.value=e,x.value=l,R.value&&R.value.open()},q=async a=>{for(var e=0;e<i.value.length;e++)if(a.공정코드==i.value[e].공정코드){alert("등록된 공정입니다.");return}const l={DIA_CODE:o.value.diagram,PRC_CODE:a.공정코드,PRC_NAME:a.공정명,FAC_TYPE:a.설비유형},p=await n.post("http://localhost:3000/prcModalConfirm",l);console.log(p),await w()};return(a,e)=>(J(),H(Z,null,[t(z,{title:S.value.title,breadcrumbs:F.value},null,8,["title","breadcrumbs"]),t(K,{title:"제품 목록"},{default:d(()=>[r("div",le,[t(u,{label:"제품 검색",modelValue:a.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=l=>a.searchKeyword=l),"hide-details":"",class:"mr-2",style:{"max-width":"280px"}},null,8,["modelValue"]),t(c,{color:"darkText",onClick:a.searchData},{default:d(()=>e[6]||(e[6]=[m("검색")])),_:1},8,["onClick"])]),r("div",te,[r("div",oe,[t(v(k),{rowData:C.value,columnDefs:O.value,theme:v(b),style:{height:"500px",width:"100%"},onCellValueChanged:V,rowSelection:"single",onRowClicked:L,onGridReady:N},null,8,["rowData","columnDefs","theme"])]),r("div",se,[r("div",de,[t(_,{class:"mb-4"},{default:d(()=>[t(D,{cols:"6"},{default:d(()=>[t(u,{label:"제품명",modelValue:o.value.product,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.product=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(D,{cols:"6"},{default:d(()=>[t(u,{label:"공정흐름도 코드",modelValue:o.value.diagram,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.diagram=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(D,{cols:"6"},{default:d(()=>[t(u,{label:"작성자",modelValue:o.value.writer,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.writer=l),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(D,{cols:"6"},{default:d(()=>[t(u,{label:"등록일",modelValue:o.value.addDate,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.addDate=l),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(_,{justify:"center"},{default:d(()=>[t(c,{color:"error",class:"mr-3",onClick:B},{default:d(()=>e[7]||(e[7]=[m("초기화")])),_:1}),t(c,{color:"primary",class:"mr-6",onClick:I},{default:d(()=>e[8]||(e[8]=[m("저장")])),_:1})]),_:1})]),_:1})]),e[11]||(e[11]=r("br",null,null,-1)),e[12]||(e[12]=r("h5",null,"공정목록",-1)),e[13]||(e[13]=r("br",null,null,-1)),r("div",re,[t(_,{justify:"end"},{default:d(()=>[t(c,{color:"warning",class:"mr-4",onClick:e[5]||(e[5]=l=>j("공정 조회",A.value,G)),style:{"margin-bottom":"2rem"}},{default:d(()=>e[9]||(e[9]=[m("공정 조회 ")])),_:1}),t(c,{color:"error",class:"mr-4",onClick:$},{default:d(()=>e[10]||(e[10]=[m("삭제")])),_:1})]),_:1}),t(ee,{ref_key:"modalRef",ref:R,title:y.value,rowData:P.value,colDefs:x.value,onConfirm:q},null,8,["title","rowData","colDefs"]),t(v(k),{rowData:i.value,columnDefs:T.value,theme:v(b),style:{height:"250px",width:"100%"},onCellValueChanged:V,rowDragManaged:!0,animateRows:!0,rowSelection:"multiple",onGridReady:M,onRowDragEnd:U},null,8,["rowData","columnDefs","theme"])])])])]),_:1})],64))}},pe=ae(ne,[["__scopeId","data-v-feeb5f37"]]);export{pe as default};
