import{aZ as H,a_ as J,O as a,P as X,y as V,a7 as ee,_ as te,q as R,o as M,a as o,w as i,d as _,k as le,V as k,b as S,a2 as ae,f as C,e as D,A as y,a1 as oe,F as se,$ as N,a9 as A}from"./index-BkOgXO0r.js";import{_ as ne,a as ue}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as E}from"./main-CfRLyuEJ.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"grid-wrap"},ie={key:0,class:"grid-wrap",style:{"margin-top":"12px"}},ce={__name:"QualityStandardManagement",setup(fe){H.registerModules([J]);const h=oe,B=a({title:"품질 기준 관리"}),L=X([{title:"품질",disabled:!0,href:"#"},{title:"품질 기준 관리",disabled:!1,href:"#"}]),b=a([]),g=a([]),f=a({}),w=a(new Map),O=(t,e)=>`${t}|||${e}`,c=a({type:""}),$=a([{field:"기준",flex:.9,headerName:"기준",editable:!1},{field:"허용수치",flex:1.3,headerName:"허용수치",editable:!1}]),x=a({resizable:!0,sortable:!0}),q=a({defaultColDef:x.value,getRowId:t=>t.data._id,deltaRowDataMode:!0}),T=a([{field:"기준",flex:.9,headerName:"기준",editable:!0},{field:"허용수치",flex:1.3,headerName:"허용수치",editable:!0}]),I=a({resizable:!0,sortable:!1,filter:!1}),z=V(()=>{const t=c.value.type;return t?f.value[t]||[]:[]});let p=null;const F=t=>{p=t.api,A(()=>{t.api.getDisplayedRowCount()>0&&t.api.selectIndex(0)})},s=a(null),u=a(null),U=t=>{const e=t.api.getSelectedRows();e.length>0?(s.value={...e[0]},u.value={...e[0]}):(s.value=null,u.value=null)},Q=V(()=>s.value?[s.value]:[]),j=t=>{const e=t.colDef.field,n=t.newValue;s.value&&(s.value[e]=n)},G=()=>{p&&p.refreshCells()},P=()=>{if(!s.value||!u.value){alert("선택된 항목이 없습니다.");return}const t=c.value.type,e=f.value[t]||[],n=e.findIndex(m=>m._id===u.value._id);if(n===-1){alert("해당 데이터를 찾을 수 없습니다.");return}const v={...u.value},r={...s.value},l=e.slice();l[n]=r,f.value={...f.value,[t]:l},u.value={...r};const d=O(t,v.기준);w.value.set(d,{TYPE:t,STD_NAME:r.기준,ALLOWED_VALUE:r.허용수치}),alert("상단에 반영되었습니다. (등록 버튼을 눌러 저장하세요)")},W=async()=>{const t=Array.from(w.value.values());if(t.length===0){alert("저장할 변경사항이 없습니다.");return}try{for(const e of t)await N.post("http://localhost:3000/qstdupdate",e);w.value.clear(),alert("변경사항이 저장되었습니다.")}catch(e){console.error("저장 실패:",e),alert("저장 중 오류가 발생했습니다.")}},K=()=>{u.value&&(s.value={...u.value})};ee(()=>c.value.type,()=>{s.value=null,u.value=null,p&&A(()=>{p.getDisplayedRowCount()>0&&p.selectIndex(0)})});const Y=async()=>{try{const t="http://localhost:3000/qstdlist",{data:e}=await N.get(t),n=(e||[]).map(l=>{const d=l.std_type??l.CODE_NAME??l.code_name,m=l.STD_NAME,Z=l.ALLOWED_VALUE;return{_id:`${d}|${m}`,type:d,기준:m,허용수치:Z}});b.value=n;const v=[...new Set(n.map(l=>l.type).filter(Boolean))];g.value=v,c.value.type||(c.value.type=v[0]||"");const r={};for(const l of n){const d=l.type||"기타";r[d]||(r[d]=[]),r[d].push(l)}f.value=r}catch(t){console.error("/qstdlist 조회 실패:",t),b.value=[],g.value=[],f.value={}}};return te(()=>{Y()}),(t,e)=>(M(),R(se,null,[o(ne,{title:B.value.title,breadcrumbs:L.value},null,8,["title","breadcrumbs"]),o(ue,null,{default:i(()=>[o(k,null,{default:i(()=>[o(S,{cols:"3"},{default:i(()=>[o(ae,{modelValue:c.value.type,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value.type=n),items:g.value,label:"제품 구분",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),o(S,{cols:"auto",class:"d-flex justify-end"},{default:i(()=>[o(C,{class:"ml-2",color:"primary",onClick:W},{default:i(()=>e[1]||(e[1]=[D("등록")])),_:1})]),_:1})]),_:1}),_("div",de,[o(y(E),{theme:y(h),style:{height:"420px",width:"100%"},columnDefs:$.value,rowData:z.value,defaultColDef:x.value,gridOptions:q.value,rowSelection:"single",suppressRowClickSelection:!1,onGridReady:F,onSelectionChanged:U,onCellValueChanged:G},null,8,["theme","columnDefs","rowData","defaultColDef","gridOptions"])]),e[5]||(e[5]=_("br",null,null,-1)),s.value?(M(),R("div",ie,[e[4]||(e[4]=_("div",{style:{padding:"10px","background-color":"#f5f5f5","font-weight":"bold"}},"선택한 기준",-1)),o(k,{justify:"end",class:"mb-2 pa-2"},{default:i(()=>[o(C,{color:"error",class:"top_btn_ser",variant:"elevated",onClick:K},{default:i(()=>e[2]||(e[2]=[D("입력초기화")])),_:1}),o(C,{color:"primary",class:"top_btn_ser",onClick:P},{default:i(()=>e[3]||(e[3]=[D("상단에 반영")])),_:1})]),_:1}),o(y(E),{style:{height:"120px"},theme:y(h),rowData:Q.value,columnDefs:T.value,defaultColDef:I.value,singleClickEdit:!0,onCellValueChanged:j},null,8,["theme","rowData","columnDefs","defaultColDef"])])):le("",!0)]),_:1})],64))}},we=re(ce,[["__scopeId","data-v-21a7d2a3"]]);export{we as default};
