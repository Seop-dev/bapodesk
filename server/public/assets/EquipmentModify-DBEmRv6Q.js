import{aZ as X,a_ as ee,O as n,a8 as le,_ as ae,P as te,q as oe,o as x,a as o,w as s,c as se,k as ne,V as _,b as m,f as T,e as y,a0 as r,A as k,a1 as de,d as re,a2 as ue,aY as ie,a3 as me,a4 as Y,W as fe,F as ce,$ as f}from"./index-BkOgXO0r.js";import{_ as Ae,a as pe}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{_ as Ce}from"./NewModal-C5NqQFOW.js";import{B as _e}from"./main-CfRLyuEJ.js";const ye={class:"text-right mt-2"},c="http://localhost:3000",be={__name:"EquipmentModify",setup(Ve){X.registerModules([ee]);const w=de,I=`${c}/facility`,M=`${c}/facilityUpdate`,N=`${c}/process`,U=`${c}/common/codes/FC`,A=n({}),p=n([]),S=e=>(Array.isArray(e)?e:[]).reduce((l,t)=>(l[t.code]=t.code_name??t.code,l),{}),h=async()=>{const{data:e}=await f.get(U);p.value=Array.isArray(e)?e:[],A.value=S(p.value)},d=n(""),i=n(null),B=n(null),L=e=>{i.value=e.api,B.value=e.columnApi,d.value&&C(d.value)},C=e=>{i.value&&(i.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:String(e||"")}}),i.value.onFilterChanged())},V=n([]),$=n([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{headerName:"설비유형",flex:1,valueGetter:e=>{var l,t;return A.value[(l=e.data)==null?void 0:l.FAC_TYPE]||((t=e.data)==null?void 0:t.FAC_TYPE)||""}},{field:"사용유무",flex:1,cellStyle:e=>e.value==="사용"?{color:"blue",fontWeight:"bold"}:e.value==="정지"?{color:"red",fontWeight:"bold"}:null},{field:"제조사",flex:1},{field:"설비등록일",flex:1},{field:"설비설치일",flex:1},{field:"담당자",flex:1}]),O={editable:!1,sortable:!0,resizable:!0},v=e=>typeof e=="string"?e.slice(0,10):e??"",G=e=>({공정코드:e.PR_ID??"",설비코드:e.FAC_ID??"",설비명:e.FAC_NAME??"",FAC_TYPE:e.FAC_TYPE??"",사용유무:(e.FAC_USE??1)===1?"사용":"정지",제조사:e.FAC_COMPANY??"",설비등록일:v(e.FAC_MDATE),설비설치일:v(e.FAC_IDATE),담당자:e.MANAGER??"",PR_ID:e.PR_ID??"",FAC_CHECKDAY:e.FAC_CHECKDAY??null}),D=async()=>{const{data:e}=await f.get(I);V.value=(Array.isArray(e)?e:[]).map(G),d.value&&C(d.value)},a=le({code:"",name:"",type:"",useYn:"",manufacturer:"",registeredAt:"",installedAt:"",manager:"",remark:"",prId:"",checkDay:null}),q=e=>{const l=e.data;a.code=l.설비코드,a.name=l.설비명,a.type=l.FAC_TYPE||"",a.useYn=l.사용유무||"",a.manufacturer=l.제조사||"",a.registeredAt=l.설비등록일||"",a.installedAt=l.설비설치일||"",a.manager=l.담당자||"",a.remark="",a.prId=l.PR_ID||l.공정코드||"",a.checkDay=l.FAC_CHECKDAY??null,d.value=a.prId||""},z=async()=>{var F,R,P;if(!a.code)return alert("수정할 설비를 선택하세요.");const e=a.registeredAt?String(a.registeredAt).slice(0,10):null,l=a.installedAt?String(a.installedAt).slice(0,10):null,t={FAC_ID:a.code,FAC_NAME:a.name||null,FAC_TYPE:a.type||null,FAC_USE:a.useYn==="사용"?1:0,FAC_COMPANY:a.manufacturer||null,FAC_MDATE:e,FAC_IDATE:l,FAC_CHECKDAY:a.checkDay??null,PR_ID:a.prId||null,MANAGER:a.manager||null,MEMO:a.remark||null};try{(await f.put(M,t,{headers:{"Content-Type":"application/json"}})).status===200?(alert("수정 되었습니다"),await D(),(F=i.value)==null||F.refreshCells({force:!0})):alert("수정 실패")}catch(u){console.error("[facility update] error:",u),alert(((P=(R=u==null?void 0:u.response)==null?void 0:R.data)==null?void 0:P.error)||u.message||"수정 저장 실패")}},E=n(null),g=n(""),b=n([]),H=n([{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1},{field:"작성자",headerName:"작성자",flex:1},{field:"비고",headerName:"비고",flex:1}]),K=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:A.value[e.FAC_TYPE]||e.FAC_TYPE||"",등록일자:typeof e.PRC_RDATE=="string"?e.PRC_RDATE.slice(0,10):e.PRC_RDATE??"",작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),W=async()=>{const{data:e}=await f.get(N);return(Array.isArray(e)?e:[]).map(K)},j=async e=>{var l;try{g.value=e,b.value=await W(),(l=E.value)==null||l.open()}catch(t){console.error("[process list] error:",t),alert("공정 목록 조회 실패")}},Q=e=>{e&&(d.value=e.공정코드||"",C(e.공정코드))};ae(async()=>{try{await h(),await D()}catch(e){console.error("[init] error:",e),alert("초기 로딩 실패")}});const Z=n({title:"설비 정보 관리"}),J=te([{title:"설비",disabled:!0,href:"#"},{title:"설비 수정",disabled:!1,href:"#"}]);return(e,l)=>(x(),oe(ce,null,[o(Ae,{title:Z.value.title,breadcrumbs:J.value},null,8,["title","breadcrumbs"]),o(pe,{title:"설비 수정"},{default:s(()=>[o(_,{class:"mb-2 py-0"},{default:s(()=>[o(m,{cols:"12",class:"d-flex align-center"},{default:s(()=>[o(T,{color:"warning",variant:"flat",onClick:l[0]||(l[0]=t=>j("공정 조회"))},{default:s(()=>l[11]||(l[11]=[y("공정 조회")])),_:1})]),_:1})]),_:1}),o(_,{class:"mb-4 pt-0"},{default:s(()=>[o(m,{cols:"12",md:"3"},{default:s(()=>[o(r,{label:"공정코드",modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value=t),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),o(k(_e),{style:{height:"220px"},theme:k(w),rowData:V.value,columnDefs:$.value,defaultColDef:O,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:L,onRowClicked:q},null,8,["theme","rowData","columnDefs"]),o(Ce,{ref_key:"modalRef",ref:E,title:g.value,rowData:b.value,colDefs:H.value,onConfirm:Q},null,8,["title","rowData","colDefs"]),a.code?(x(),se(fe,{key:0,class:"mt-6 pa-4"},{default:s(()=>[o(_,{dense:""},{default:s(()=>[o(m,{cols:"12",md:"6"},{default:s(()=>[o(r,{label:"설비코드",modelValue:a.code,"onUpdate:modelValue":l[2]||(l[2]=t=>a.code=t),dense:"",outlined:"",readonly:""},null,8,["modelValue"]),o(r,{label:"설비명",modelValue:a.name,"onUpdate:modelValue":l[3]||(l[3]=t=>a.name=t),dense:"",outlined:""},null,8,["modelValue"]),o(ue,{label:"설비유형",modelValue:a.type,"onUpdate:modelValue":l[4]||(l[4]=t=>a.type=t),items:p.value,"item-title":"code_name","item-value":"code",dense:"",outlined:"",clearable:"",placeholder:"설비유형 선택"},null,8,["modelValue","items"]),o(r,{label:"제조사",modelValue:a.manufacturer,"onUpdate:modelValue":l[5]||(l[5]=t=>a.manufacturer=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"6"},{default:s(()=>[o(r,{label:"설비등록일",modelValue:a.registeredAt,"onUpdate:modelValue":l[6]||(l[6]=t=>a.registeredAt=t),type:"date",dense:"",outlined:""},null,8,["modelValue"]),o(r,{label:"설비설치일",modelValue:a.installedAt,"onUpdate:modelValue":l[7]||(l[7]=t=>a.installedAt=t),type:"date",dense:"",outlined:""},null,8,["modelValue"]),o(r,{label:"담당자",modelValue:a.manager,"onUpdate:modelValue":l[8]||(l[8]=t=>a.manager=t),dense:"",outlined:""},null,8,["modelValue"]),o(r,{label:"비고",modelValue:a.remark,"onUpdate:modelValue":l[9]||(l[9]=t=>a.remark=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(m,{cols:"12",md:"6"},{default:s(()=>[o(ie,{class:"mb-2 d-block"},{default:s(()=>l[12]||(l[12]=[y("사용유무")])),_:1}),o(me,{modelValue:a.useYn,"onUpdate:modelValue":l[10]||(l[10]=t=>a.useYn=t),inline:""},{default:s(()=>[o(Y,{label:"사용",value:"사용"}),o(Y,{label:"정지",value:"정지"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),re("div",ye,[o(T,{color:"success",onClick:z},{default:s(()=>l[13]||(l[13]=[y("수정")])),_:1})])]),_:1})):ne("",!0)]),_:1})],64))}};export{be as default};
