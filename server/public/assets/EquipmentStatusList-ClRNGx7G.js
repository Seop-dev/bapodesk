import{_ as L,a as U}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as X}from"./main-CfRLyuEJ.js";import{aZ as j,a_ as Q,O as n,P as Z,q as J,o as ee,a as o,w as i,V as R,b as T,f as te,e as ae,a0 as le,A as g,a1 as se,F as oe,$ as u}from"./index-BkOgXO0r.js";import{d as x}from"./dayjs.min-DF61od3U.js";import{_ as ne}from"./NewModal-C5NqQFOW.js";const f="http://localhost:3000",me={__name:"EquipmentStatusList",setup(ie){j.registerModules([Q]);const v=se,w=`${f}/process`;let m=new Map;const M=async()=>{const{data:e}=await u.get(`${f}/common/codes/FC`),a=new Map;for(const s of e||[])a.set(s.code??s.CODE,s.code_name??s.CODE_NAME);m=a},r=n(""),b={editable:!1,sortable:!0,resizable:!0},c=n(null),N=async e=>{c.value=e.api,await $()},_=e=>{c.value&&(c.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:e||""}}),c.value.onFilterChanged())},P=e=>({0:"가동",1:"비가동",2:"점검중"})[Number(e)]??String(e),S=e=>e==="가동"?{color:"blue",fontWeight:"bold"}:e==="비가동"?{color:"red",fontWeight:"bold"}:null,p=e=>e?x(e).format("YYYY-MM-DD"):"",Y=n([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{field:"설비유형",flex:1},{field:"설비상태",flex:1,cellStyle:e=>S(e.value)},{field:"비가동사유",flex:1},{field:"점검완료일",flex:1},{field:"다음점검일",flex:1},{field:"담당자",flex:1}]),C=n([]),h=async()=>{const{data:e}=await u.get(`${f}/facility`);return e||[]},V=async()=>{try{const{data:e}=await u.get(`${f}/facility/status`);return e||[]}catch{return[]}},A=e=>new Date(e.FS_CHECKDAY||e.DOWN_ENDDAY||e.DOWN_STARTDAY||0).getTime(),O=(e,a)=>{const s=new Map;for(const l of a||[]){const t=s.get(l.FAC_ID);(!t||A(l)>=A(t))&&s.set(l.FAC_ID,l)}return(e||[]).map(l=>{const t=s.get(l.FAC_ID),d=t?Number(t.FS_STATUS):0,H=P(d);let F="-";d===2&&(F=t!=null&&t.FS_CHECKDAY?p(t.FS_CHECKDAY):"-");const K=l.FAC_TYPE_NM??(l.FAC_TYPE?m.get(String(l.FAC_TYPE))||l.FAC_TYPE:"-");return{공정코드:l.PR_ID||"",설비코드:l.FAC_ID,설비명:l.FAC_NAME||"",설비유형:K,설비상태:H,비가동사유:d===1&&(t==null?void 0:t.FS_REASON)||"-",점검완료일:F,다음점검일:t!=null&&t.FS_NEXTDAY?p(t.FS_NEXTDAY):"-",담당자:l.MANAGER&&l.MANAGER!=="-"?l.MANAGER:(t==null?void 0:t.MANAGER)||"-"}})},$=async()=>{await M();const[e,a]=await Promise.all([h(),V()]);C.value=O(e,a),r.value&&_(r.value)},D=n(null),y=n(""),E=n([]),I=n([{field:"공정코드",flex:1},{field:"공정명",flex:1},{field:"설비유형",flex:1},{field:"등록일자",flex:1},{field:"작성자",flex:1},{field:"비고",flex:1}]),B=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:e.FAC_TYPE??"",등록일자:e.PRC_RDATE?x(e.PRC_RDATE).format("YYYY-MM-DD"):"",작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),G=async()=>{const{data:e}=await u.get(w);return(Array.isArray(e)?e:[]).map(B)},W=async e=>{var a;try{y.value=e,E.value=await G(),(a=D.value)==null||a.open()}catch(s){console.error("[process list] error:",s),alert("공정 목록 조회 실패")}},k=e=>{e&&(r.value=e.공정코드||"",_(e.공정코드))},q=n({title:"설비 상태 관리"}),z=Z([{title:"설비",disabled:!0,href:"#"},{title:"전체 조회",disabled:!1,href:"#"}]);return(e,a)=>(ee(),J(oe,null,[o(L,{title:q.value.title,breadcrumbs:z.value},null,8,["title","breadcrumbs"]),o(U,{title:"전체 조회"},{default:i(()=>[o(R,{class:"mb-2 py-0"},{default:i(()=>[o(T,{cols:"12",class:"d-flex align-center"},{default:i(()=>[o(te,{color:"warning",variant:"flat",onClick:a[0]||(a[0]=s=>W("공정 조회"))},{default:i(()=>a[2]||(a[2]=[ae("공정 조회")])),_:1})]),_:1})]),_:1}),o(R,{class:"mb-4 pt-0"},{default:i(()=>[o(T,{cols:"12",md:"3"},{default:i(()=>[o(le,{label:"공정코드",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value=s),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),o(g(X),{style:{height:"420px"},theme:g(v),rowData:C.value,columnDefs:Y.value,defaultColDef:b,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:N},null,8,["theme","rowData","columnDefs"])]),_:1}),o(ne,{ref_key:"modalRef",ref:D,title:y.value,rowData:E.value,colDefs:I.value,onConfirm:k},null,8,["title","rowData","colDefs"])],64))}};export{me as default};
