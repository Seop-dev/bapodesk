import{O as f,P as re,_ as de,$ as h,y as V,q as ue,o as Q,a as o,w as r,d as m,f as g,e as v,V as ne,b as c,a0 as i,aM as se,aN as M,A as Y,c as ie,k as me,t as W,j as ce,Y as fe,W as pe,S as ve,T as ge,Z as ye,aO as De,F as Ve}from"./index-BkOgXO0r.js";import{_ as Ce,a as we}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as $}from"./main-CfRLyuEJ.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"card-headline only-right"},he={class:"right-actions"},_e={class:"center-actions-under-note"},Re={class:"pane mt-4"},Te={class:"pane-head"},Ee={class:"pane-action"},Se={class:"table-footline"},_="http://localhost:3000",be=5,ke=10,Oe={__name:"ProductionPlan",setup(Ue){const z=f({title:"생산계획 관리"}),L=re([{title:"생산",disabled:!0,href:"#"},{title:"생산계획 관리",disabled:!1,href:"#"}]),a=f({issueNumber:"",orderDate:"",contact:"",orderNo:"",productCode:"",dueDate:"",dueDate2:"",targetQty:0,productName:"",memo:"",productType:""});function b(){const l=new Date;return`PL-${l.getFullYear()}${String(l.getMonth()+1).padStart(2,"0")}${String(l.getDate()).padStart(2,"0")}-${Math.floor(Math.random()*9e3)+1e3}`}de(()=>{a.value.issueNumber=b(),O().catch(()=>{})});const k=f([]),C=f("");async function O(){try{const{data:l}=await h.get(`${_}/products`,{params:{kw:C.value,page:1,size:50}});k.value=Array.isArray(l==null?void 0:l.rows)?l.rows:[]}catch(l){console.error(l),u("제품 조회 오류","error")}}const w=V(()=>a.value.productType||null),F=V(()=>{const l=C.value.trim().toLowerCase();return k.value.filter(e=>!w.value||e.type===w.value).filter(e=>!l||e.code.toLowerCase().includes(l)||e.name.toLowerCase().includes(l))}),I=V(()=>F.value),n={cellStyle:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},tooltipValueGetter:l=>l.value},U={...n,cellClass:"ag-right-aligned-cell",valueFormatter:l=>l.value==null?"":String(l.value)},G=[{headerName:"제품코드",field:"code",flex:1.1,minWidth:120,...n},{headerName:"제품명칭",field:"name",flex:1.6,minWidth:140,...n},{headerName:"유형",field:"type",flex:.8,minWidth:90,...n},{headerName:"단위",field:"uom",flex:.6,minWidth:70,...n},{headerName:"규격",field:"spec",flex:1.2,minWidth:120,...n},{headerName:"현재고",field:"stock",flex:.7,minWidth:80,...U}];let s;function B(l){s=l.api,R()}function A(l){l&&l.sizeColumnsToFit()}function R(){A(s)}function K(){var t;if(!s)return u("그리드 준비중입니다.","error");const l=((t=s.getSelectedRows)==null?void 0:t.call(s))??[];if(!l.length)return u("등록할 제품을 선택하세요.","error");const e=l[0];if(a.value.productType||(a.value.productType=e.type),a.value.productType!==e.type)return u(`선택 가능한 유형은 '${a.value.productType}' 입니다.`,"error");a.value.productCode=e.code,a.value.productName=e.name,u("제품이 계획서에 등록되었습니다.")}const y=f(!1),P=f(""),T=f([]),E=f([]);async function x(){try{const{data:l}=await h.get(`${_}/reqSelect`);T.value=Array.isArray(l)?l.map(e=>({...e,REQ_QTY:Number(e.REQ_QTY)})):[]}catch(l){console.error(l),u("주문서 조회 오류","error")}}const q=V(()=>{const l=P.value.trim().toLowerCase();return l?T.value.filter(e=>String(e.REQ_ID).toLowerCase().includes(l)||String(e.CUS_NAME).toLowerCase().includes(l)||String(e.PRD_NAME).toLowerCase().includes(l)):T.value}),j=V(()=>q.value),Z=[{headerName:"",checkboxSelection:!0,headerCheckboxSelection:!0,width:70},{headerName:"주문일자",field:"REQ_DATE",minWidth:120,...n},{headerName:"주문번호",field:"REQ_ID",minWidth:120,...n},{headerName:"업체명",field:"CUS_NAME",minWidth:120,flex:1,...n},{headerName:"제품코드",field:"PRD_CODE",minWidth:110,...n},{headerName:"제품명",field:"PRD_NAME",minWidth:140,flex:1,...n},{headerName:"제품유형",field:"PRODUCT_TYPE",width:100,...n},{headerName:"주문수량",field:"REQ_QTY",width:100,...U},{headerName:"납기일자",field:"REQ_DDAY",minWidth:120,...n},{headerName:"주문상태",field:"REQ_STATUS",width:100,...n}];let d;function H(l){var e;d=l.api,(e=d.sizeColumnsToFit)==null||e.call(d)}function J(l){const e=l.api.getSelectedRows();if(e.length<=1)return;const t=e[0];for(const p of e.slice(1)){const S=p.PRD_CODE===t.PRD_CODE,oe=(p.PRODUCT_TYPE??"")===(t.PRODUCT_TYPE??"");if(!S||t.PRODUCT_TYPE&&!oe){l.api.forEachNode(N=>{N.isSelected()&&(N.data.PRD_CODE!==t.PRD_CODE||t.PRODUCT_TYPE&&N.data.PRODUCT_TYPE!==t.PRODUCT_TYPE)&&N.setSelected(!1)}),u("같은 제품(유형)만 복수 선택 가능합니다.","error");break}}}function X(){P.value="",y.value=!0,setTimeout(()=>{var l;return(l=d==null?void 0:d.deselectAll)==null?void 0:l.call(d)},0),x()}function ee(){var t;if(!d)return u("그리드 준비중입니다.","error");const l=((t=d.getSelectedRows)==null?void 0:t.call(d))??[];if(!l.length)return u("선택된 주문서가 없습니다.","error");const e=l[0];a.value.orderNo=e.REQ_ID,a.value.productCode=e.PRD_CODE,a.value.productName=e.PRD_NAME,e.PRODUCT_TYPE&&(a.value.productType=e.PRODUCT_TYPE),a.value.targetQty=l.reduce((p,S)=>p+Number(S.REQ_QTY||0),0),a.value.dueDate2=[...l.map(p=>p.REQ_DDAY)].sort()[0],E.value=l.map(p=>String(p.REQ_ID)),y.value=!1,u("주문서가 적용되었습니다.")}async function le(){if(!a.value.issueNumber||!a.value.orderDate)return u("계획번호/계획명을 입력하세요.","error");if(!a.value.productCode)return u("제품을 등록하세요.","error");try{const{data:l}=await h.post(`${_}/plans`,{form:a.value,linkedOrderIds:E.value});l!=null&&l.ok?(u("저장되었습니다."),await te()):u("저장 실패","error")}catch(l){console.error(l),u("저장 중 오류","error")}}async function te(){try{const{data:l}=await h.get(`${_}/plans`,{params:{kw:"",page:1,size:20}});l!=null&&l.ok&&console.log("생산계획 목록",l.rows)}catch(l){console.error(l)}}function ae(){var e,t;const l=b();a.value={issueNumber:l,orderDate:"",contact:"",orderNo:"",productCode:"",dueDate:"",dueDate2:"",targetQty:0,productName:"",memo:"",productType:""},(e=s==null?void 0:s.deselectAll)==null||e.call(s),(t=d==null?void 0:d.deselectAll)==null||t.call(d),u("초기화되었습니다."),E.value=[]}const D=f({open:!1,msg:"",color:"primary"}),u=(l,e="primary")=>D.value={open:!0,msg:l,color:e};return(l,e)=>(Q(),ue(Ve,null,[o(Ce,{title:z.value.title,breadcrumbs:L.value},null,8,["title","breadcrumbs"]),o(we,null,{default:r(()=>[m("div",Ne,[e[16]||(e[16]=m("h5",{class:"title"},"생산계획 등록",-1)),m("div",he,[o(g,{color:"warning",onClick:X},{default:r(()=>e[15]||(e[15]=[v("주문서 조회")])),_:1})])]),o(ne,{class:"mb-2"},{default:r(()=>[o(c,{cols:"4"},{default:r(()=>[o(i,{label:"계획번호",modelValue:a.value.issueNumber,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.issueNumber=t),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"계획명",modelValue:a.value.orderDate,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.orderDate=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"작성자",modelValue:a.value.contact,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.contact=t),dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"주문번호",modelValue:a.value.orderNo,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.orderNo=t),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"작성일자",modelValue:a.value.dueDate,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.dueDate=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"납기일자",modelValue:a.value.dueDate2,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.dueDate2=t),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"총 수량",modelValue:a.value.targetQty,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.targetQty=t),modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"제품코드",modelValue:a.value.productCode,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.productCode=t),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"4"},{default:r(()=>[o(i,{label:"제품명칭",modelValue:a.value.productName,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.productName=t),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),o(c,{cols:"12"},{default:r(()=>[o(se,{label:"비고",modelValue:a.value.memo,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.memo=t),modelModifiers:{trim:!0},rows:"2","auto-grow":"",dense:"",variant:"outlined",class:"text-right"},null,8,["modelValue"])]),_:1})]),_:1}),m("div",_e,[o(g,{variant:"flat",color:"error",onClick:ae},{default:r(()=>e[17]||(e[17]=[v("초기화")])),_:1}),o(g,{color:"primary",onClick:le},{default:r(()=>e[18]||(e[18]=[v("생산계획 등록")])),_:1})]),m("section",Re,[m("div",Te,[e[20]||(e[20]=m("h5",{class:"pane-title"},"제품목록",-1)),m("div",Ee,[o(i,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value=t),modelModifiers:{trim:!0},placeholder:"제품코드/명 검색","hide-details":"",density:"compact",variant:"outlined",class:"search-input-right",onKeyup:M(O,["enter"])},null,8,["modelValue"]),o(g,{color:"primary",class:"ml-2",onClick:K},{default:r(()=>e[19]||(e[19]=[v("제품 등록")])),_:1})])]),o(Y($),{class:"ag-theme-quartz ag-no-wrap",rowData:I.value,columnDefs:G,pagination:!0,paginationPageSize:be,suppressPaginationPanel:!1,domLayout:"autoHeight",rowSelection:"single",rowMultiSelectWithClick:!1,onGridReady:B,onFirstDataRendered:R,onGridSizeChanged:R},null,8,["rowData"]),m("div",Se,[w.value?(Q(),ie(ce,{key:0,size:"small",color:"primary",variant:"tonal"},{default:r(()=>[v(" 선택 고정 유형: "+W(w.value),1)]),_:1})):me("",!0)])]),o(fe,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=t=>y.value=t),width:"90vw"},{default:r(()=>[o(pe,{class:"plan-card"},{default:r(()=>[o(ve,{class:"d-flex align-center justify-space-between"},{default:r(()=>[e[21]||(e[21]=m("span",null,"주문서 목록",-1)),o(i,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=t=>P.value=t),modelModifiers:{trim:!0},placeholder:"주문번호/업체/제품명 검색","hide-details":"",density:"compact",variant:"outlined",style:{width:"320px"},onKeyup:M(x,["enter"])},null,8,["modelValue"])]),_:1}),o(ge,{class:"dialog-body"},{default:r(()=>[o(Y($),{class:"ag-theme-quartz ag-no-wrap",rowData:j.value,columnDefs:Z,pagination:!0,paginationPageSize:ke,rowSelection:"multiple",rowMultiSelectWithClick:!0,suppressRowClickSelection:!0,domLayout:"autoHeight",onGridReady:H,onSelectionChanged:J},null,8,["rowData"])]),_:1}),o(ye,{class:"justify-end"},{default:r(()=>[o(g,{variant:"flat",color:"darkText",onClick:e[12]||(e[12]=t=>y.value=!1)},{default:r(()=>e[22]||(e[22]=[v("닫기")])),_:1}),o(g,{variant:"flat",color:"success",onClick:ee},{default:r(()=>e[23]||(e[23]=[v("적용")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(De,{modelValue:D.value.open,"onUpdate:modelValue":e[14]||(e[14]=t=>D.value.open=t),color:D.value.color,timeout:2e3},{default:r(()=>[v(W(D.value.msg),1)]),_:1},8,["modelValue","color"])]),_:1})],64))}},We=Pe(Oe,[["__scopeId","data-v-3ba62242"]]);export{We as default};
