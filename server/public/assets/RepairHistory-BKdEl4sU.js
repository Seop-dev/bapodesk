import{aZ as N,a_ as v,O as d,_ as P,y as Y,P as I,q as V,o as B,a as r,w as p,V as L,b as z,a0 as O,A as C,a1 as k,F as q,$ as n}from"./index-BkOgXO0r.js";import{_ as G,a as H}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as j}from"./main-CfRLyuEJ.js";const i="http://localhost:3000",W={__name:"RepairHistory",setup(K){N.registerModules([v]);const F=k,M=d([{field:"설비코드",flex:1},{field:"설비명",flex:1},{field:"설비유형",flex:1},{field:"고장유형",flex:1},{field:"비가동시작일",flex:1.5},{field:"수리완료일",flex:1.5},{field:"수리내역",flex:1.5},{field:"담당자",flex:1},{field:"비고",flex:2}]),R={editable:!1,sortable:!0,resizable:!0,suppressMenu:!0},f=d(""),c=d([]);function _(a){if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return String(a);const s=l=>String(l).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}:${s(t.getSeconds())}`}let g=new Map,w=new Map;const y=async()=>{const[a,t]=await Promise.all([n.get(`${i}/common/codes/FC`),n.get(`${i}/common/codes/RR`)]),s=l=>{const u=new Map;for(const e of l||[])u.set(String(e.code??e.CODE),e.code_name??e.CODE_NAME);return u};g=s(a.data),w=s(t.data)},h=async()=>(await n.get(`${i}/facility/repairs`)).data||[],A=async()=>(await n.get(`${i}/facility`)).data||[],D=async()=>(await n.get(`${i}/facility/status`)).data||[];P(async()=>{try{await y();const[a,t,s]=await Promise.all([h(),A(),D()]),l=new Map(t.map(e=>[e.FAC_ID,e])),u=new Map(s.map(e=>[e.FS_ID,e]));c.value=a.map(e=>{const o=l.get(e.FAC_ID)||{},S=u.get(e.FS_ID)||{},T=o.FAC_TYPE?g.get(String(o.FAC_TYPE))||o.FAC_TYPE:o.FAC_TYPE_NM||"",m=e.FR_TYPE??S.FS_TYPE??null,$=m?w.get(String(m))||m:"";return{설비코드:e.FAC_ID??"",설비명:o.FAC_NAME??"",설비유형:T,고장유형:$,비가동시작일:_(e.FR_STARTDAY),수리완료일:_(e.FR_ENDDAY),수리내역:e.FR_CONTENT??"",담당자:e.MANAGER??o.MANAGER??"",비고:e.FR_NOTE??""}})}catch(a){console.error("loadRepairs error",a),c.value=[]}});const x=Y(()=>{const a=(f.value||"").trim().toLowerCase();return a?c.value.filter(t=>{const s=String(t.설비코드||"").toLowerCase(),l=String(t.설비명||"").toLowerCase();return s.includes(a)||l.includes(a)}):c.value}),E=d({title:"설비 수리 관리"}),b=I([{title:"설비",disabled:!0,href:"#"},{title:"수리 내역",disabled:!1,href:"#"}]);return(a,t)=>(B(),V(q,null,[r(G,{title:E.value.title,breadcrumbs:b.value},null,8,["title","breadcrumbs"]),r(H,{title:"수리 내역"},{default:p(()=>[r(L,{align:"center",class:"mb-3"},{default:p(()=>[r(z,{cols:"12",md:"6",class:"d-flex justify-start"},{default:p(()=>[r(O,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=s=>f.value=s),modelModifiers:{trim:!0},placeholder:"설비선택 (설비코드/설비명 입력)","hide-details":"",density:"compact",variant:"outlined",style:{"max-width":"280px"}},null,8,["modelValue"])]),_:1})]),_:1}),r(C(j),{class:"ag-theme-quartz grid-clean",style:{height:"420px"},theme:C(F),rowData:x.value,columnDefs:M.value,defaultColDef:R,animateRows:!0,pagination:!0,"pagination-page-size":10,suppressClickEdit:!0},null,8,["theme","rowData","columnDefs"])]),_:1})],64))}};export{W as default};
