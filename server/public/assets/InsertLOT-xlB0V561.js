import{_ as y,a as I}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as M}from"./main-CfRLyuEJ.js";import{O as r,P as R,q as L,o as P,a as t,w as o,V as x,f as u,e as i,b as k,a0 as S,A as m,aE as B,a1 as F,F as Q,$ as d}from"./index-BkOgXO0r.js";import{_ as $}from"./NewModal-C5NqQFOW.js";import{u as w}from"./auth-DHaV788y.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={__name:"InsertLOT",setup(U){var C;const c=w(),E=F,s=r([]),N=r([{field:"입고번호",flex:1},{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"발주수량",headerName:"발주 수량",flex:1},{field:"입고수량",headerName:"입고 수량",flex:1},{field:"합격수량",headerName:"합격 수량",flex:1}]),n=((C=c.user)==null?void 0:C.name)||"",f=r(null),p=r(""),T=r([]),_=r([]),h=[{field:"입고번호",headerName:"입고번호",flex:1.5},{field:"자재명",headerName:"자재명",flex:1},{field:"자재코드",headerName:"자재코드",flex:1},{field:"규격",headerName:"규격",flex:1.5},{field:"단위",headerName:"단위",flex:1},{field:"합격수량",headerName:"합격수량",flex:1}],D=r([]),b=async l=>{p.value=l,_.value=h;try{const e=await d.get("http://localhost:3000/materialPass");T.value=e.data.map(a=>({입고번호:a.RECEIPT_NO,자재명:a.MAT_NAME,자재코드:a.MAT_CODE,규격:a.MAT_SIZE,단위:a.MAT_UNIT,합격수량:a.TOTAL_QTY,발주수량:a.RECEIPT_QTY,입고수량:a.RECEIVED_QTY})),f.value&&f.value.open()}catch(e){console.error(e),alert("원자재 합격품 목록을 불러오는 데 실패했습니다.")}};function A(l){Array.isArray(l)||(l=[l]),l.forEach(e=>{s.value.push({입고번호:e.입고번호||"",자재명:e.자재명||"",자재코드:e.자재코드||"",규격:e.규격||"",단위:e.단위||"",발주수량:e.발주수량||0,입고수량:e.입고수량||0,합격수량:e.합격수량||0})})}function v(){var l;n.value=((l=c.user)==null?void 0:l.name)||"",s.value=[]}async function O(){if(!n.value){alert("담당자를 입력해주세요.");return}if(s.value.length===0){alert("등록할 LOT가 없습니다.");return}try{s.value.map(a=>d.post("http://localhost:3000/LOTInsert",{MAT_CODE:a.자재코드,MANAGER:n.value,MAT_QTY:a.합격수량,RECEIPT_NO:a.입고번호}));const l=s.value.map(a=>a.입고번호),e=[...new Set(l)];await Promise.all(e.map(a=>d.put("http://localhost:3000/updateTMP",{RECEIPT_NO:a,STATUS:"입고 완료"}))),alert("LOT 등록 완료!"),v()}catch(l){console.error(l),alert("LOT 등록 중 오류가 발생했습니다.")}}const V=r({title:"재고"}),g=R([{title:"자재",disabled:!0,href:"#"},{title:"LOT 등록",disabled:!1,href:"#"}]);return(l,e)=>(P(),L(Q,null,[t(y,{title:V.value.title,breadcrumbs:g.value},null,8,["title","breadcrumbs"]),t(I,{title:"LOT 등록"},{default:o(()=>[t($,{ref_key:"modalRef",ref:f,title:p.value,rowData:T.value,colDefs:_.value,onConfirm:A},null,8,["title","rowData","colDefs"]),t(x,{class:"mb-4"},{default:o(()=>[t(u,{color:"warning",class:"mr-2 button",onClick:e[0]||(e[0]=a=>b("원자재 합격 수량 조회",D.value,h)),style:{"margin-bottom":"2rem"}},{default:o(()=>e[2]||(e[2]=[i(" 원자재 합격 수량 조회 ")])),_:1}),t(k,{cols:"3"},{default:o(()=>[t(S,{label:"담당자",modelValue:m(n),"onUpdate:modelValue":e[1]||(e[1]=a=>B(n)?n.value=a:null),outlined:"",style:{"margin-left":"2rem"}},null,8,["modelValue"])]),_:1})]),_:1}),t(m(M),{rowData:s.value,columnDefs:N.value,theme:m(E),style:{height:"200px",width:"100%"},onCellValueChanged:l.onCellValueChanged},null,8,["rowData","columnDefs","theme","onCellValueChanged"]),t(x,{justify:"end",style:{"margin-top":"2rem"}},{default:o(()=>[t(u,{color:"error",class:"mr-2",onClick:v},{default:o(()=>e[3]||(e[3]=[i("초기화")])),_:1}),t(u,{color:"primary",onClick:O},{default:o(()=>e[4]||(e[4]=[i("등록")])),_:1})]),_:1})]),_:1})],64))}},K=Y(q,[["__scopeId","data-v-ba0fee75"]]);export{K as default};
