import{O as o,P as ee,a7 as le,_ as te,$ as u,q as ae,o as oe,a,w as s,d as r,V as D,b as c,a0 as f,A as y,f as w,e as p,a1 as ne,F as se}from"./index-BkOgXO0r.js";import{B as re}from"./main-CfRLyuEJ.js";import{_ as k}from"./NewModal-C5NqQFOW.js";import{_ as ie,a as de}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"main-container"},fe={class:"list-container"},me={class:"add"},ve={__name:"OrderForm",setup(De){const A=o({mode:"multiRow"}),t=o({dDay:"",rDay:"",writer:"",client:"",client_code:""}),P=ee([{title:"영업",disabled:!0,href:"#"},{title:"주문서",disabled:!0,href:"#"},{title:"주문서 등록",disabled:!1,href:"#"}]),U=o({title:"주문서 등록"}),q=ne,Q=new Date().toISOString().split("T")[0],_=o(null),$=o(null);le(_,l=>{t.value.client=(l==null?void 0:l.cusName)??""}),te(()=>{Y(),W()});const R=o(null),B=l=>{R.value=l.api},F=o([{field:"제품코드",flex:1},{field:"제품명",flex:1},{field:"제품유형",flex:1},{field:"규격",flex:1},{field:"주문수량",flex:1,editable:!0,cellDataType:"number"},{field:"단위",flex:1}]),d=o([]),O=l=>{if(l.colDef.field==="주문수량"){const e=Number(String(l.newValue).toString().replaceAll(",",""));!Number.isFinite(e)||e<=0?(l.data.주문수량=1,l.api.applyTransaction({update:[l.data]})):(l.data.주문수량=e,l.api.applyTransaction({update:[l.data]}))}},m=o(null),C=o(""),b=o([]),V=o([]),G=[{field:"거래처코드",headerName:"거래처코드",flex:1},{field:"거래처명",headerName:"거래처명",flex:1},{field:"거래담당자",headerName:"거래담당자",flex:1}],x=o([]),Y=async()=>{try{const l=await u.get("http://localhost:3000/reqCusModal");x.value=l.data.map(e=>({거래처코드:e.CUS_ID,거래처명:e.CUS_NAME,거래담당자:e.CUS_MANAGER}))}catch(l){console.error(l);return}},j=async(l,e,n)=>{C.value=l,b.value=e,V.value=n,m.value&&m.value.open()},z=l=>{t.value.client=l.거래처명,t.value.client_code=l.거래처코드,console.log(t.value.client_code)},v=o(null),N=o(""),g=o([]),M=o([]),L=[{field:"제품코드",headerName:"제품코드",flex:1},{field:"제품명",headerName:"제품명",flex:1},{field:"제품유형",headerName:"제품유형",flex:1},{field:"규격",headerName:"규격",flex:1},{field:"단위",headerName:"단위",flex:1}],E=o([]),W=async()=>{try{const l=await u.get("http://localhost:3000/reqPrdModal");E.value=l.data.map(e=>({제품코드:e.PRD_CODE,제품명:e.PRD_NAME,제품유형:e.PRD_TYPE,규격:e.PRD_SIZE,단위:e.PRD_UNIT}))}catch(l){console.error(l);return}},Z=async(l,e,n)=>{N.value=l,M.value=n,g.value=e,v.value&&v.value.open()},H=l=>{console.log(l),d.value.unshift(l)},J=()=>{t.value={client:"",dDay:"",rDay:""},d.value=[],_.value=null,$.value=null},K=async()=>{var h,I;if(!t.value.client||!t.value.dDay){alert("거래처와 납기일을 확인하세요");return}const l=R.value.getSelectedRows();if(l.length===0){alert("등록할 제품을 선택하세요");return}if(l.some(i=>!i.주문수량||i.주문수량<=0)){alert("모든 제품의 수량을 입력해주세요");return}const n={CUS_ID:t.value.client_code,REQ_DATE:t.value.rDay,REQ_DDAY:t.value.dDay,WRITER:t.value.writer},S=await u.post("http://localhost:3000/reqInsert",n);if(!((h=S.data)!=null&&h.success)){alert("주문서(헤더) 등록 실패");return}const T=S.data.reqId,X={reqId:T,rows:l.map(i=>({REQ_QTY:Number(i.주문수량),PRD_CODE:i.제품코드}))};if(!((I=(await u.post("http://localhost:3000/reqDetailInsert",X)).data)!=null&&I.success)){alert("주문서(상세) 등록 실패");return}alert(`주문서 등록완료 (번호: ${T})`),t.value={dDay:"",rDay:"",writer:"",client:"",client_code:""},d.value=[]};return(l,e)=>(oe(),ae(se,null,[a(ie,{title:U.value.title,breadcrumbs:P.value},null,8,["title","breadcrumbs"]),a(de,{title:"주문서 등록"},{default:s(()=>[r("div",ce,[r("div",fe,[r("div",me,[a(D,{class:"mb-4"},{default:s(()=>[a(c,{cols:"6"},{default:s(()=>[a(f,{label:"거래처명",modelValue:t.value.client,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.client=n),outlined:"",readonly:"",onClick:e[1]||(e[1]=n=>j("거래처 조회",x.value,G))},null,8,["modelValue"])]),_:1}),a(k,{ref_key:"modalRef",ref:m,title:C.value,rowData:b.value,colDefs:V.value,onConfirm:z},null,8,["title","rowData","colDefs"]),a(c,{cols:"6"},{default:s(()=>[a(f,{label:"주문일자",modelValue:t.value.rDay,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.rDay=n),type:"date",outlined:""},null,8,["modelValue"])]),_:1}),a(c,{cols:"6"},{default:s(()=>[a(f,{label:"납기일자",modelValue:t.value.dDay,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.dDay=n),type:"date",min:y(Q),outlined:""},null,8,["modelValue","min"])]),_:1}),a(c,{cols:"6"},{default:s(()=>[a(f,{label:"작성자",modelValue:t.value.writer,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.writer=n),outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),a(D,{justify:"end"},{default:s(()=>[a(w,{color:"warning",class:"mr-6",onClick:e[5]||(e[5]=n=>Z("제품 조회",E.value,L))},{default:s(()=>e[6]||(e[6]=[p("제품 추가")])),_:1})]),_:1}),e[9]||(e[9]=r("br",null,null,-1)),e[10]||(e[10]=r("br",null,null,-1)),a(y(re),{columnDefs:F.value,rowData:d.value,theme:y(q),style:{height:"300px",width:"100%"},onCellValueChanged:O,rowSelection:A.value,onRowClicked:l.onRowClicked,onGridReady:B},null,8,["columnDefs","rowData","theme","rowSelection","onRowClicked"]),e[11]||(e[11]=r("br",null,null,-1)),e[12]||(e[12]=r("br",null,null,-1)),a(D,{justify:"end"},{default:s(()=>[a(w,{color:"error",class:"mr-6",onClick:J},{default:s(()=>e[7]||(e[7]=[p("초기화")])),_:1}),a(w,{color:"primary",class:"mr-6",onClick:K},{default:s(()=>e[8]||(e[8]=[p("등록")])),_:1})]),_:1})])]),a(k,{ref_key:"itemModalRef",ref:v,title:N.value,rowData:g.value,colDefs:M.value,onConfirm:H},null,8,["title","rowData","colDefs"])]),_:1})],64))}},be=ue(ve,[["__scopeId","data-v-e1a2cf3a"]]);export{be as default};
