import{_ as R,a as O}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as I}from"./main-CfRLyuEJ.js";import{O as n,a8 as k,P as w,q as U,o as q,a as t,w as o,V as i,f,e as d,b as m,a0 as c,A as v,a1 as B,F,$ as x}from"./index-BkOgXO0r.js";import{_ as $}from"./NewModal-C5NqQFOW.js";import{u as P}from"./auth-DHaV788y.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={__name:"MaterialEquest",setup(L){var A;const D=P(),C=B,s=n([]),E=n([{field:"입고번호",flex:1.5},{field:"자재명",flex:1},{field:"자재코드",flex:1},{field:"규격",flex:1},{field:"단위",flex:1},{field:"수량",flex:1},{field:"사유",flex:1.5}]),r=k({insertDate:new Date().toISOString().slice(0,10),reDate:"",manager:((A=D.user)==null?void 0:A.name)||""}),u=n(null),_=n(""),p=n([]),T=n([]),g=[{field:"입고번호",headerName:"입고번호",flex:1.5},{field:"자재명",headerName:"자재명",flex:1},{field:"자재코드",headerName:"자재코드",flex:1},{field:"규격",headerName:"규격",flex:1.5},{field:"단위",headerName:"단위",flex:.8},{field:"수량",headerName:"수량",flex:1},{field:"상태",flex:.8,cellStyle:l=>l.value==="등록"?{color:"black",fontWeight:"bold"}:l.value==="완료"?{color:"red",fontWeight:"bold"}:null}],V=n([]),h=async l=>{_.value=l,T.value=g;try{const e=await x.get("http://localhost:3000/failMaterials");p.value=e.data.filter(a=>a.MAT_STATUS!=="완료").map(a=>({입고번호:a.RECEIPT_NO,자재명:a.MAT_NAME,자재코드:a.MAT_CODE,규격:a.MAT_SIZE,단위:a.MAT_UNIT,수량:a.TOTAL_QTY,상태:a.MAT_STATUS,사유:a.RJT_REASON})),u.value&&u.value.open()}catch(e){console.error("자재 목록을 가져오는 중 오류가 발생했습니다:"+e),alert("자재 목록을 불러오는 데 실패했습니다.")}};function S(l){Array.isArray(l)||(l=[l]),l.forEach(e=>{s.value.push({입고번호:e.입고번호||"",자재명:e.자재명||"",자재코드:e.자재코드||"",규격:e.규격||"",단위:e.단위||"",수량:e.수량||0,사유:e.사유||""})})}function b(){var l;r.manager=((l=D.user)==null?void 0:l.name)||"",r.insertDate=new Date().toISOString().substring(0,10),r.reDate="",s.value=[]}async function y(){try{if(!r.manager||!r.insertDate||!r.reDate){alert("모든 필드를 입력해주세요.");return}const l={CREATED_DATE:new Date().toISOString().slice(0,10),RR_DATE:r.reDate,MANAGER:r.manager,RE_STATUS:"등록"},e=s.value.map(a=>({MAT_CODE:a.자재코드,RE_QTY:a.수량||0,RECEIPT_NO:a.입고번호}));await x.post("http://localhost:3000/return/request/insert",{requestData:l,detailList:e}),alert("등록 되었습니다."),b()}catch(l){console.error(l),alert("등록 중 오류가 발생했습니다.")}}const M=n({title:"불량품"}),N=w([{title:"자재",disabled:!0,href:"#"},{title:"자재반품요청서 등록 ",disabled:!1,href:"#"}]);return(l,e)=>(q(),U(F,null,[t(R,{title:M.value.title,breadcrumbs:N.value},null,8,["title","breadcrumbs"]),t(O,{title:"자재반품요청서 등록"},{default:o(()=>[t($,{ref_key:"modalRef",ref:u,title:_.value,rowData:p.value,colDefs:T.value,onConfirm:S},null,8,["title","rowData","colDefs"]),t(i,{class:"mb-4"},{default:o(()=>[t(f,{color:"warning",class:"mr-2 button",onClick:e[0]||(e[0]=a=>h("자재검수성적서 조회",V.value,g)),style:{"margin-bottom":"2rem"}},{default:o(()=>e[4]||(e[4]=[d(" 불량품 조회 ")])),_:1})]),_:1}),t(i,{class:"mb-4"},{default:o(()=>[t(m,{cols:"6"},{default:o(()=>[t(c,{label:"작성일자",modelValue:r.insertDate,"onUpdate:modelValue":e[1]||(e[1]=a=>r.insertDate=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1}),t(m,{cols:"6"},{default:o(()=>[t(c,{label:"회수요청일자",modelValue:r.reDate,"onUpdate:modelValue":e[2]||(e[2]=a=>r.reDate=a),type:"date",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(v(I),{rowData:s.value,columnDefs:E.value,theme:v(C),style:{height:"200px",width:"100%"},onCellValueChanged:l.onCellValueChanged},null,8,["rowData","columnDefs","theme","onCellValueChanged"]),t(i,{class:"mb-4 ggg"},{default:o(()=>[t(m,{cols:"6"},{default:o(()=>[t(c,{label:"담당자",modelValue:r.manager,"onUpdate:modelValue":e[3]||(e[3]=a=>r.manager=a),outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{justify:"end"},{default:o(()=>[t(f,{color:"error",class:"mr-2",onClick:b},{default:o(()=>e[5]||(e[5]=[d("초기화")])),_:1}),t(f,{color:"primary",onClick:y},{default:o(()=>e[6]||(e[6]=[d("등록")])),_:1})]),_:1})]),_:1})],64))}},H=Q(z,[["__scopeId","data-v-e3aaf2c5"]]);export{H as default};
