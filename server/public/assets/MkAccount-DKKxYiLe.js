import{_ as q,a as P}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{aa as E,_ as v,ab as U,ac as j,ad as k,ae as z,O as t,$ as p,P as O,q as Q,o as Y,a as s,w,d as r,A as c,a1 as G,V as H,f as J,e as K,F as L,af as W}from"./index-BkOgXO0r.js";import{B as _}from"./main-CfRLyuEJ.js";import{_ as X}from"./NewModal-C5NqQFOW.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"main-container"},ae={class:"list-container"},le={__name:"MkAccount",setup(te){const x=G,C=E();function h(){if(typeof C.tick!="function"){console.warn("[sim] store.tick() 없음 → ticker 미시작");return}typeof window<"u"&&typeof requestAnimationFrame=="function"&&W()}v(h),U(h),j(()=>k()),z(()=>k());const f=t(null);v(()=>{i()});const N=async()=>{if(!l.value[0].거래처유형||!l.value[0].거래처명||!l.value[0].담당자||!l.value[0].사용여부){alert("비어있는 항목이 존재합니다.");return}if(!(l.value[0].사용여부==="여"||l.value[0].사용여부==="부")){alert("여/부 확인");return}if(!confirm("등록하시겠습니까?"))return;const a={cusType:l.value[0].거래처유형,cusName:l.value[0].거래처명,cusManager:l.value[0].담당자,cusUse:l.value[0].사용여부==="여"?1:0,cusNote:l.value[0].비고};try{const{data:e}=await p.post("/api/marketing/insertacc",a);e.affectedRows>0?(await i(),alert("성공적으로 등록되었습니다."),Object.keys(l.value[0]).forEach(o=>{l.value[0][o]=""})):alert("데이터 등록 실패");return}catch(e){console.error(e),alert("오류가 발생하였습니다.");return}},l=t([{거래처유형:null,거래처명:null,담당자:null,사용여부:null,비고:null}]),R=t([{field:"거래처유형",flex:1,cellClass:"clickable-cell",headerClass:"with-mag",editable:!1,onCellClicked:a=>{f.value=a.node.rowIndex,M("거래처유형",I.value,F)}},{field:"거래처명",flex:1,editable:!0},{field:"담당자",flex:1,editable:!0},{field:"사용여부",flex:1,editable:!0},{field:"비고",flex:1,editable:!0}]),d=t([]);t("");const V=t([{headerName:"거래처코드",field:"cusId",flex:1},{headerName:"거래처유형",field:"cusType",flex:1},{headerName:"거래처명",field:"cusName",flex:1},{headerName:"담당자",field:"cusManager",flex:1},{headerName:"사용여부",field:"cusUse",flex:1,valueFormatter:a=>a.value==="Y"||a.value===1||a.value==="1"?"사용":"미사용"},{headerName:"비고",field:"cusNote",flex:1},{headerName:"삭제",field:"actions",flex:.5,cellRenderer:a=>{const e=document.createElement("button");return e.type="button",e.textContent="삭제",e.style.cursor="pointer",e.onclick=()=>A(a.data.cusId),e}}]),A=async a=>{if(confirm("정말 삭제하시겠습니까?"))try{const{data:e}=await p.delete(`/api/marketing/deleteacc/${a}`);console.log(e),e.affectedRows>0?(alert("삭제되었습니다."),await i()):alert("삭제 실패")}catch(e){console.error(e),alert("삭제 중 오류가 발생했습니다.")}};async function i(a={}){const{q:e=null}=a,{data:o}=await p.get("/api/marketing/getacclist",{params:{q:e,_ts:Date.now()}});d.value=Array.isArray(o)?o:[],console.log("거래처 목록:",d.value)}v(()=>i());const B=t({title:"거래처등록 및 조회"}),T=O([{title:"거래처",disabled:!0,href:"#"},{title:"거래처등록 및 조회",disabled:!1,href:"#"}]),b=a=>{console.log(a.value),console.log(l.value)},m=t(null),D=t(""),g=t([]),y=t([]),M=(a,e,o)=>{var n,u;D.value=a,g.value=e,y.value=o,(u=(n=m.value)==null?void 0:n.open)==null||u.call(n)},S=a=>{var o,n;if(f.value==null)return;const e=f.value;l.value=l.value.map((u,$)=>$===e?{...u,거래처유형:a.거래처유형}:u),(n=(o=m.value)==null?void 0:o.close)==null||n.call(o)},F=[{field:"거래처유형",headerName:"거래처유형",flex:1}],I=t([{거래처유형:"고객사"},{거래처유형:"공급사"},{거래처유형:"외주업체"},{거래처유형:"운송업체"},{거래처유형:"폐기업체"}]);return(a,e)=>(Y(),Q(L,null,[s(q,{title:B.value.title,breadcrumbs:T.value},null,8,["title","breadcrumbs"]),s(P,{title:"거래처등록 및 조회"},{default:w(()=>[r("div",ee,[r("div",ae,[e[1]||(e[1]=r("h5",null,"거래처등록",-1)),s(c(_),{rowData:l.value,columnDefs:R.value,theme:c(x),style:{height:"90px",width:"100%"},onCellValueChanged:b},null,8,["rowData","columnDefs","theme"]),e[2]||(e[2]=r("br",null,null,-1)),e[3]||(e[3]=r("br",null,null,-1)),s(H,{justify:"end"},{default:w(()=>[s(J,{color:"primary",class:"mr-6",onClick:N},{default:w(()=>e[0]||(e[0]=[K("등록")])),_:1})]),_:1}),e[4]||(e[4]=r("h5",null,"거래처목록",-1)),s(c(_),{rowData:d.value,columnDefs:V.value,theme:c(x),style:{height:"360px",width:"100%"},onCellValueChanged:b},null,8,["rowData","columnDefs","theme"])]),s(X,{ref_key:"modalRef",ref:m,title:D.value,rowData:g.value,colDefs:y.value,onConfirm:S},null,8,["title","rowData","colDefs"]),e[5]||(e[5]=r("div",{class:"d-flex align-right mb-4"},null,-1))])]),_:1})],64))}},ie=Z(le,[["__scopeId","data-v-6cbf9941"]]);export{ie as default};
