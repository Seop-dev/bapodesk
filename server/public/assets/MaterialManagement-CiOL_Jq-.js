import{aZ as I,b1 as z,b2 as G,O as l,P as j,y as K,_ as Y,b3 as H,q as $,o as L,a,w as r,b4 as J,V as y,b as g,f as N,e as v,A as m,a1 as U,d as _,j as Z,t as C,b5 as X,W as ee,S as te,T as ae,aM as le,F as oe,$ as S}from"./index-BkOgXO0r.js";import{_ as re,a as se}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{B as R}from"./main-CfRLyuEJ.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"d-flex align-center"},de={class:"ml-auto text-caption"},ue={__name:"MaterialManagement",setup(ce){I.registerModules([z,G]);const b=U,s=H(),x=l({title:"원자재 검수관리 등록"}),E=l([{title:"품질",disabled:!0,href:"#"},{title:"원자재 검수관리 등록",disabled:!1,href:"#"}]),i=l({description:""}),T=l([{_id:"moisture",label:"함수율",allow:"수분 함량 12~15% (KS범위)"},{_id:"appearance",label:"외관결점",allow:"옹이≤150mm, 활결≤50%, 전체길이 1% 이내"},{_id:"thickness",label:"치수정밀도",allow:"입고자재 ±2mm 이내"},{_id:"strength",label:"강도",allow:"KS F 2207, 횡강도 ≥ 35MPa"},{_id:"surface",label:"외관/표면 결함",allow:"육안확인 시 결점 없음"}]),f=j(null),w=l({resizable:!0,minWidth:120,sortable:!1}),V=l({mode:"multiRow"}),M=l({headerName:"판정",pinned:"right",width:90,headerCheckboxSelection:!0,headerCheckboxSelectionCurrentPageOnly:!1,checkboxSelection:!0,suppressHeaderMenuButton:!0}),O=l([{headerName:"검사기준",field:"label",minWidth:160,flex:1},{headerName:"허용수치",field:"allow",minWidth:360,flex:2},{headerName:"판정",colId:"result",minWidth:120,maxWidth:140,valueGetter:e=>{var t;return(t=e.node)!=null&&t.isSelected()?"합격":"불합격"},cellClass:e=>e.value==="합격"?"ag-cell-success":"ag-cell-error",sortable:!1}]),Q=l({defaultColDef:w.value,getRowId:e=>e.data._id}),d=l(0),u=l(0),n=K(()=>u.value===d.value?"합격":"불합격");function A(e){f.value=e.api}function B(e){const t=[];e.api.forEachNode(o=>t.push(o)),e.api.setNodesSelected({nodes:t,newValue:!0}),h()}function h(){const e=f.value;e&&(d.value=e.getDisplayedRowCount(),u.value=e.getSelectedNodes().length,e.refreshCells({columns:["result"],force:!0}),u.value===d.value&&(i.value={category:"",severity:"",description:""}))}const c=l([{id:"(자동생성)",inNo:"(자동입력)",materialCode:"(자동입력)",totalQty:"(자동입력)",user:"(세션사용자)",inDate:"(자동입력)",doneDate:"(현재 yyyyMMdd)"}]);function k(e){const t=Number(String(e.newValue).replace(/,/g,"").trim());return Number.isFinite(t)?t:e.oldValue}const q=l([{headerName:"원자재검사번호",field:"id",width:170,editable:!1},{headerName:"입고번호",field:"inNo",width:140,editable:!1},{headerName:"원자재코드",field:"materialCode",width:150,editable:!1},{headerName:"총수량",field:"totalQty",width:110,editable:!0,valueParser:k},{headerName:"작성자",field:"user",width:120,editable:!0},{headerName:"입고일자",field:"inDate",width:140,editable:!0},{headerName:"검사완료일자",field:"doneDate",width:140,editable:!0}]),P=l({defaultColDef:{resizable:!0,minWidth:110},autoSizeStrategy:{type:"fitGridWidth"}});Y(()=>{const e=c.value[0];e.inNo=String(s.query.receiptNo||""),e.materialCode=String(s.query.matCode||""),e.materialName=String(s.query.materialName||""),e.totalQty=Number(s.query.totalQty||0),e.inDate=String(s.query.inDate||""),e.user=String(s.query.createdBy||"");const t=new Date;e.doneDate=t.toISOString().slice(0,10)});function W(){const e=f.value;if(e){const o=[];e.forEachNode(p=>o.push(p)),e.setNodesSelected({nodes:o,newValue:!1}),h()}const t=c.value[0];t.totalQty=0,t.passQty=0,t.user="",t.inDate="",t.doneDate="",i.value={category:"",severity:"",description:""}}async function F(){var D;const e=c.value[0],t=n.value==="합격";if(!t&&!i.value.description.trim()){alert("불합격 사유를 입력해주세요.");return}const o={RECEIPT_NO:e.inNo.trim(),MAT_CODE:e.materialCode.trim(),Q_CHECKED_DATE:e.doneDate,TOTAL_QTY:Number(e.totalQty)||0,CREATED_BY:((D=e.user)==null?void 0:D.trim())||null},p={RECEIPT_NO:e.inNo,MAT_CODE:e.materialCode,RJT_REASON:i.value.description.trim().slice(0,100),Q_CHECKED_DATE:e.doneDate,TOTAL_QTY:Number(e.totalQty),CREATED_BY:e.user};t?(await S.post("http://localhost:3000/passmat",o),alert("합격등록이 완료되었습니다.")):(await S.post("http://localhost:3000/rjtmat",p),alert("불합격등록이 완료되었습니다."))}return(e,t)=>(L(),$(oe,null,[a(re,{title:x.value.title,breadcrumbs:E.value},null,8,["title","breadcrumbs"]),a(se,null,{default:r(()=>[a(y,{justify:"end",class:"mb-2"},{default:r(()=>[a(g,null,{default:r(()=>[a(N,{color:"error",class:"top_btn_ser",variant:"elevated",onClick:W},{default:r(()=>t[1]||(t[1]=[v("초기화")])),_:1}),a(N,{color:"primary",class:"top_btn_ser",onClick:F},{default:r(()=>t[2]||(t[2]=[v("등록")])),_:1})]),_:1})]),_:1}),a(m(R),{rowData:T.value,columnDefs:O.value,defaultColDef:w.value,rowSelection:V.value,selectionColumnDef:M.value,gridOptions:Q.value,theme:m(b),style:{height:"280px",width:"100%"},onGridReady:A,onFirstDataRendered:B,onSelectionChanged:h},null,8,["rowData","columnDefs","defaultColDef","rowSelection","selectionColumnDef","gridOptions","theme"]),a(y,{class:"my-4"},{default:r(()=>[a(g,{cols:"12",class:"py-1"},{default:r(()=>[_("div",ne,[t[3]||(t[3]=_("h5",{class:"mr-4"},"최종처리",-1)),a(Z,{color:n.value=="합격"?"primary":"error"},{default:r(()=>[v(C(n.value),1)]),_:1},8,["color"]),_("span",de,"선택 "+C(u.value)+"/"+C(d.value),1)])]),_:1})]),_:1}),J(a(ee,{class:"mb-4",elevation:"2"},{default:r(()=>[a(te,{class:"bg-red-lighten-5 text-red-darken-2"}),a(ae,null,{default:r(()=>[a(le,{modelValue:i.value.description,"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.description=o),label:"불합격 사유",variant:"outlined",rows:"3",counter:"500",maxlength:"500",rules:[o=>n.value==="합격"||o&&o.length>0||"불합격 시 사유는 필수입니다."]},null,8,["modelValue","rules"])]),_:1})]),_:1},512),[[X,n.value==="불합격"]]),a(m(R),{rowData:c.value,columnDefs:q.value,gridOptions:P.value,theme:m(b),style:{height:"160px",width:"100%"}},null,8,["rowData","columnDefs","gridOptions","theme"])]),_:1})],64))}},ve=ie(ue,[["__scopeId","data-v-1d5ae344"]]);export{ve as default};
