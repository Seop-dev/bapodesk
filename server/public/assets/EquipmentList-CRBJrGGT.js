import{aZ as I,a_ as L,O as l,a8 as B,_ as O,P as k,q as $,o as q,a as o,w as i,V as v,b as h,f as G,e as z,a0 as U,A as y,a1 as W,F as H,$ as r}from"./index-BkOgXO0r.js";import{_ as K,a as Q}from"./UiParentCard.vue_vue_type_script_setup_true_lang-BW8k9qJX.js";import{_ as Z}from"./NewModal-C5NqQFOW.js";import{B as j}from"./main-CfRLyuEJ.js";const J="http://localhost:3000/facility/status",X="http://localhost:3000/process",ee="http://localhost:3000/common/codes/FC",ae="http://localhost:3000/common/codes/RR",ne={__name:"EquipmentList",setup(te){I.registerModules([L]);const x=W,s=l(""),E=l(""),u=B({items:[]}),d=l({}),m=l({}),_=e=>(Array.isArray(e)?e:[]).reduce((a,t)=>(t!=null&&t.code&&(a[t.code]=t.code_name??t.code),a),{}),c=e=>typeof e=="string"?e.slice(0,10):e??"",F=l([{field:"공정코드",hide:!0,filter:"agTextColumnFilter"},{field:"설비코드",flex:1},{field:"설비명",flex:1},{headerName:"설비유형",flex:1,valueGetter:e=>{var a,t;return d.value[(a=e.data)==null?void 0:a.FAC_TYPE]||((t=e.data)==null?void 0:t.FAC_TYPE)||""}},{field:"사용유무",flex:1,cellStyle:e=>e.value==="사용"?{color:"blue",fontWeight:"bold"}:e.value==="정지"?{color:"red",fontWeight:"bold"}:null},{field:"제조사",flex:1},{field:"설비제조일",flex:1},{field:"설비설치일",flex:1},{field:"점검주기일",flex:1},{headerName:"고장유형",field:"고장유형",flex:1},{field:"담당자",flex:1}]),n=l(null),P=l(null),R=e=>{n.value=e.api,P.value=e.columnApi,s.value&&f(s.value)},f=e=>{n.value&&(n.value.setFilterModel({공정코드:{filterType:"text",type:"equals",filter:String(e)}}),n.value.onFilterChanged())},g=e=>({공정코드:e.PR_ID??"",설비코드:e.FAC_ID??"",설비명:e.FAC_NAME??"",FAC_TYPE:e.FAC_TYPE??"",사용유무:(e.FAC_USE??1)===1?"사용":"정지",제조사:e.FAC_COMPANY??"",설비제조일:c(e.FAC_MDATE),설비설치일:c(e.FAC_IDATE),점검주기일:e.FAC_CHECKDAY??"",고장유형:m.value[e.FS_TYPE]||(e.FS_TYPE??"-"),담당자:e.MANAGER??""}),D=async()=>{const[e,a]=await Promise.all([r.get(ee),r.get(ae)]);d.value=_(e.data),m.value=_(a.data)},T=async()=>{const{data:e}=await r.get(J);u.items=(Array.isArray(e)?e:[]).map(g),s.value&&f(s.value)};O(async()=>{try{await D(),await T()}catch(e){console.error("[init] error:",e),alert("초기 로딩 실패")}});const p=l(null),C=l(""),A=l([]),b=l([{field:"공정코드",headerName:"공정코드",flex:1},{field:"공정명",headerName:"공정명",flex:1},{field:"설비유형",headerName:"설비유형",flex:1},{field:"등록일자",headerName:"등록일자",flex:1},{field:"작성자",headerName:"작성자",flex:1},{field:"비고",headerName:"비고",flex:1}]),N=e=>({공정코드:e.PR_ID??e.PRC_CODE??"",공정명:e.PRC_NAME??"",설비유형:d.value[e.FAC_TYPE]||e.FAC_TYPE||"",등록일자:c(e.PRC_RDATE),작성자:e.PRC_WRITER??"",비고:e.PRC_NOTE??""}),w=async()=>{const{data:e}=await r.get(X);return(Array.isArray(e)?e:[]).map(N)},M=async e=>{var a;try{C.value=e,A.value=await w(),(a=p.value)==null||a.open()}catch(t){console.error("[process list] error:",t),alert("공정 목록 조회 실패")}},S=e=>{e&&(s.value=e.공정코드||"",E.value=e.공정명||"",e.공정코드&&f(e.공정코드))},V=l({title:"설비 정보 관리"}),Y=k([{title:"설비",disabled:!0,href:"#"},{title:"전체 조회",disabled:!1,href:"#"}]);return(e,a)=>(q(),$(H,null,[o(K,{title:V.value.title,breadcrumbs:Y.value},null,8,["title","breadcrumbs"]),o(Q,{title:"전체 조회"},{default:i(()=>[o(v,{class:"mb-2 py-0"},{default:i(()=>[o(h,{cols:"12",class:"d-flex align-center"},{default:i(()=>[o(G,{color:"warning",variant:"flat",onClick:a[0]||(a[0]=t=>M("공정 조회"))},{default:i(()=>a[2]||(a[2]=[z(" 공정 조회 ")])),_:1})]),_:1})]),_:1}),o(v,{class:"mb-4 pt-0"},{default:i(()=>[o(h,{cols:"12",md:"3"},{default:i(()=>[o(U,{label:"공정코드",modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=t=>s.value=t),readonly:"","hide-details":"",density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),o(Z,{ref_key:"modalRef",ref:p,title:C.value,rowData:A.value,colDefs:b.value,onConfirm:S},null,8,["title","rowData","colDefs"]),o(y(j),{style:{height:"460px","margin-top":"8px"},theme:y(x),rowData:u.items,columnDefs:F.value,animateRows:!0,suppressClickEdit:!0,pagination:!0,"pagination-page-size":10,onGridReady:R},null,8,["theme","rowData","columnDefs"])]),_:1})],64))}};export{ne as default};
